<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thank You ‚Äì BibleGateway Dark Mode Pro</title>
  <style>
    body{margin:0;font-family:system-ui,Segoe UI,Roboto,sans-serif;background:#0f1115;color:#e6e6e6;}
    .wrap{max-width:760px;margin:0 auto;padding:40px 22px;}
    h1{margin:0 0 12px;font-size:30px;}
    h2{margin:32px 0 10px;font-size:20px;}
    p{line-height:1.5;margin:10px 0;color:#aab4c3;}
    code{background:#181d25;padding:2px 6px;border-radius:5px;font-size:14px;}
    .panel{background:#161b24;border:1px solid #222a34;padding:22px;border-radius:14px;margin-top:26px;}
    .license-sample{font-size:15px;font-weight:600;color:#fff;letter-spacing:.5px;}
    ul{margin:10px 0 20px 18px;padding:0;}
    li{margin:4px 0;color:#d2d8e1;}
    a{color:#6ea8fe;}
    footer{margin-top:50px;font-size:12px;color:#8593a3;}
    input[type=text]{width:100%;padding:10px 12px;background:#0f1319;border:1px solid #28313d;border-radius:8px;color:#dce4ec;margin-top:6px;}
    button{background:#6ea8fe;color:#0f1115;border:none;padding:10px 18px;border-radius:8px;font-weight:600;cursor:pointer;margin-top:10px;}
    .result{margin-top:10px;font-size:14px;color:#9fb6cc;word-break:break-all;}
    .progress{height:6px;background:#1a2230;border-radius:6px;overflow:hidden;margin:8px 0 0 0;}
    .bar{height:100%;width:0;background:#6ea8fe;transition:width .3s ease;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar" style="display:flex;justify-content:space-between;align-items:center;padding:10px 14px;background:#0f1115;border-bottom:1px solid #1f2530;border-radius:0 0 12px 12px;margin:-40px -22px 30px -22px;">
      <nav style="display:flex;gap:16px;">
        <a href="index.html" style="color:#6ea8fe;text-decoration:none;">Home</a>
        <a href="purchase.html" style="color:#6ea8fe;text-decoration:none;">Purchase</a>
      </nav>
    </div>
    <h1>Thank You!</h1>
    <p>Your support helps keep the dark theme polished, fast, and privacy‚Äërespecting.</p>

    <!-- License panel appears here -->
    <div id="license-container"></div>

    <div class="panel">
      <h2>1. Unlock in the Extension</h2>
      <ul>
        <li>Open the extension popup.</li>
        <li>Enter your license key in the "Unlock Pro" field.</li>
        <li>Press "Unlock Pro". The Pro sliders will appear.</li>
      </ul>
    </div>

    <div class="panel">
      <h2>2. Didn't Receive a Key?</h2>
      <p>Email me and I'll send a key promptly if I can verify a stripe payment from your email address.</p>
      <p>Email: <a href="mailto:pamuszynski@gmail.com">pamuszynski@gmail.com</a></p>
    </div>

    <div class="panel">
      <h2>Roadmap</h2>
      <ul>
        <li>More color controls.</li>
        <li>Instant backup key delivery via email.</li>
      </ul>
    </div>

    <footer>
      No tracking. Your email is only used for sending a license key and support follow‚Äëups.
    </footer>
  </div>
  <script>
    // Auto-fetch a license when redirected with ?session_id=cs_...
    (async () => {
      const p = new URLSearchParams(location.search);
      const id = p.get('session_id');
      if (!id) return;
      const WORKER_BASE = 'https://bgdm-license-worker.pamuszynski.workers.dev';
      const endpoint = WORKER_BASE + '/license?session_id=' + encodeURIComponent(id);
      const container = document.getElementById('license-container');
      
      // Show prominent loading state at top
      const loadingPanel = document.createElement('div');
      loadingPanel.className = 'panel';
      loadingPanel.style.background = '#1a2533';
      loadingPanel.style.borderColor = '#2a3f5f';
      loadingPanel.innerHTML = '<h2 style="margin-top:0;">üîë Your License Key</h2><p class="result">Fetching your license code‚Ä¶</p><div class="progress"><div class="bar" style="width:10%"></div></div>';
      container.appendChild(loadingPanel);
      
      try {
        const res = await fetch(endpoint, { cache: 'no-store' });
        loadingPanel.querySelector('.bar').style.width = '60%';
        const data = await res.json();
        if (data && data.license) {
          loadingPanel.querySelector('.bar').style.width = '100%';
          loadingPanel.innerHTML = '<h2 style="margin-top:0;color:#5cb85c;">‚úÖ Your License Key</h2><p style="font-size:22px;font-weight:700;color:#fff;letter-spacing:1px;margin:16px 0;padding:18px;background:#0d1117;border:2px solid #30363d;border-radius:8px;text-align:center;">' + data.license + '</p><p><strong>Next step:</strong> Open the extension popup, paste this key into the "License" field, and click "Unlock Pro".</p>';
        } else {
          loadingPanel.querySelector('.bar').style.width = '0%';
          loadingPanel.innerHTML = '<h2 style="margin-top:0;color:#d9534f;">‚ö†Ô∏è License Not Ready</h2><p>Could not fetch your license yet. Please refresh this page in a few seconds, or contact support with your payment email.</p>';
        }
      } catch (e) {
        loadingPanel.querySelector('.bar').style.width = '0%';
        loadingPanel.innerHTML = '<h2 style="margin-top:0;color:#d9534f;">‚ö†Ô∏è Network Error</h2><p>Could not connect to the license server. Please check your connection and refresh the page.</p>';
      }
    })();
  </script>
</body>
</html>
